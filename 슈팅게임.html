<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>슈팅몬스터</title>

    <style>
        #container {
            display: block;
            width: 800px;
            height: 800px;
            margin: 30px 50px;
            border: 1px solid #000;
        }

        #container>#shooter {
            display: inline;
            width: 150px;
            height: 30px;
            margin: 0;
            background-color: #333;
            border: 1px solid #333;
            border-radius: 10px;
        }

        #stagearea {
            width: 800px;
            height: 400px;
            border: 1px solid #000;
        }

        #stagearea>#target {
            width: 70px;
            height: 15px;
            margin: 0 auto;
            background-color: #5de;
            border: 1px solid #000;
            border-radius: 10px;
        }

        .missile {
            display: block;
            width: 0;
            height: 0;
            border-width: 10px;
            border-style: solid;
            border-color: transparent transparent blue transparent;
        }
    </style>

</head>

<body>
    <div id="container">
        <div id="stagearea">
            <div id="target"></div>
        </div>
        <div id="shooter"></div>
    </div>


    <script>
        const shooterEl = document.getElementById('shooter');
        shooterEl.style.position = 'absolute';
        shooterEl.style.top = '790px';
        shooterEl.style.left = '380px';

        //슈터를 좌우화살표로 움직이는 함수
        const moveShooter = function (event) {
            let left = parseInt(shooterEl.style.left);
            if (event.key === 'ArrowLeft') {
                shooterEl.style.left = (left - 10) + "px";
            }

            if (event.key === 'ArrowRight') {
                shooterEl.style.left = (left + 10) + "px";
            }

            if (left < 70) {
                shooterEl.style.left = 70 + "px";
            }

            if (left > 705) {
                shooterEl.style.left = 705 + "px";
            }
        };

        const creatShoot = (event) => {
            let left = parseInt(shooterEl.style.left);
            let top = parseInt(shooterEl.style.top);
            let start;

            if (event.key === ' ') {
                let shoot = document.createElement('div');
                let shootTop = parseInt(shoot.style.top);
                shoot.setAttribute("class", "missile")
                document.querySelector('body').appendChild(shoot);
                shoot.style.position = 'absolute';
                shoot.style.left = (left + 65) + 'px';

                const move = (time) => {
                    // requestAnimationFrame은 같은 명령이 지속되는듯하다
                    // 따라서 단순히 start = time;로 시작시간을 저장하면
                    // time - start는 무한히 0으로 나타나게되는 현상발생
                    // 외부에서 start를 비어있는 변수로 선언하면
                    // start변수에 언디파인드가 할당
                    // if제어문을 통해 이벤트가 발생한 최초 시점의 time을
                    // start가 언디파인드인 조건에만 저장함으로써
                    // 시작시점의 strat와 계속해서 커지는 time을 구분할수 있음!
                    // 결과는 매 이벤트 발생하는 각각의 요소의 stamp를 구별하여 저장할수 있게된다~
                    if (start === undefined) {
                        start = time;
                    }

                    let stamp = Math.min(time - start, 3000);

                    shoot.style.top = 770 - stamp * 0.2 + 'px';

                    requestAnimationFrame(move);
                };

                move();

            }
        };


        window.addEventListener('keydown', moveShooter);
        window.addEventListener('keydown', creatShoot);

    </script>

</body>

</html>